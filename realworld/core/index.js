var _extends=require("@babel/runtime/helpers/extends"),_createClass=require("@babel/runtime/helpers/createClass"),core=require("@sgrud/core"),rxjs=require("rxjs"),_inheritsLoose=require("@babel/runtime/helpers/inheritsLoose"),tslib=require("tslib"),state=require("@sgrud/state"),_assertThisInitialized=require("@babel/runtime/helpers/assertThisInitialized");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var _class$1,ConfigStore_1,_extends__default=/*#__PURE__*/_interopDefaultLegacy(_extends),_createClass__default=/*#__PURE__*/_interopDefaultLegacy(_createClass),_inheritsLoose__default=/*#__PURE__*/_interopDefaultLegacy(_inheritsLoose),_assertThisInitialized__default=/*#__PURE__*/_interopDefaultLegacy(_assertThisInitialized);exports.ConfigStore=(ConfigStore_1=_class$1=/*#__PURE__*/function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).apiUrl=void 0,t}return _inheritsLoose__default.default(t,e),t}(state.Store),_class$1.handle="io.github.sgrud.state.config",_class$1),exports.ConfigStore=ConfigStore_1=tslib.__decorate([state.Stateful(ConfigStore_1.handle,{apiUrl:"https://api.realworld.io/api"})],exports.ConfigStore);var _class,UserStore_1,Endpoint=/*#__PURE__*/function(){function e(){throw new TypeError("Endpoint.constructor")}return e.readArticles=function(e){var t=void 0===e?{}:e,r=t.author,n=void 0===r?void 0:r,o=t.favorited,i=void 0===o?void 0:o,s=t.limit,a=void 0===s?10:s,u=t.offset,c=void 0===u?0:u,l=t.path,p=void 0===l?void 0:l,f=t.tag,d=void 0===f?void 0:f;return this.apiUrl.pipe(rxjs.switchMap(function(e){return core.Http.request({queryParams:_extends__default.default({},n&&{author:n},i&&{favorited:i},a&&{limit:a},c&&{offset:c},d&&{tag:d}),url:e+"/articles"+(p?"/"+p:"")})}),rxjs.map(function(e){return _extends__default.default({},e.response,{author:n,favorited:i,limit:a,offset:c,path:p,tag:d})}))},e.readArticle=function(e){return this.apiUrl.pipe(rxjs.map(function(t){return t+"/articles/"+e}),rxjs.switchMap(function(e){return core.Http.get(e)}),rxjs.map(function(e){return e.response.article}))},e.readComments=function(e){return this.apiUrl.pipe(rxjs.map(function(t){return t+"/articles/"+e+"/comments"}),rxjs.switchMap(function(e){return core.Http.get(e)}),rxjs.map(function(e){return e.response.comments}))},e.readProfile=function(e){return this.apiUrl.pipe(rxjs.map(function(t){return t+"/profiles/"+e}),rxjs.switchMap(function(e){return core.Http.get(e)}),rxjs.map(function(e){return e.response.profile}))},e.readTags=function(){return this.apiUrl.pipe(rxjs.map(function(e){return e+"/tags"}),rxjs.switchMap(function(e){return core.Http.get(e)}),rxjs.map(function(e){return e.response.tags}))},e.removeArticle=function(e){return this.apiUrl.pipe(rxjs.map(function(t){return t+"/articles/"+e.slug}),rxjs.switchMap(function(e){return core.Http.delete(e)}),rxjs.map(function(e){return e.response}))},e.removeComment=function(e,t){return this.apiUrl.pipe(rxjs.map(function(r){return r+"/articles/"+e.slug+"/comments/"+t.id}),rxjs.switchMap(function(e){return core.Http.delete(e)}),rxjs.map(function(e){return e.response}))},e.updateArticle=function(e){return this.apiUrl.pipe(rxjs.switchMap(function(t){return core.Http.request({body:{article:e},method:e.slug?"PUT":"POST",url:t+"/articles"+(e.slug?"/"+e.slug:"")})}),rxjs.map(function(e){return e.response.article}))},e.updateComment=function(e,t){return this.apiUrl.pipe(rxjs.switchMap(function(r){return core.Http.request({body:{comment:t},method:"POST",url:r+"/articles/"+e.slug+"/comments"})}),rxjs.map(function(e){return e.response.comment}))},e.updateFollow=function(e){return this.apiUrl.pipe(rxjs.switchMap(function(t){return core.Http.request({method:e.following?"DELETE":"POST",url:t+"/profiles/"+e.username+"/follow"})}),rxjs.map(function(e){return e.response.profile}))},e.updateLike=function(e){return this.apiUrl.pipe(rxjs.switchMap(function(t){return core.Http.request({method:e.favorited?"DELETE":"POST",url:t+"/articles/"+e.slug+"/favorite"})}),rxjs.map(function(e){return e.response.article}))},_createClass__default.default(e,null,[{key:"apiUrl",get:function(){return rxjs.from(new exports.ConfigStore).pipe(rxjs.first(),rxjs.map(function(e){return e.apiUrl}))}}]),e}();exports.UserStore=(UserStore_1=_class=/*#__PURE__*/function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).bio=void 0,t.email=void 0,t.image=void 0,t.token=void 0,t.username=void 0,t}_inheritsLoose__default.default(t,e);var r=t.prototype;return r.login=function(e,t){try{var r=this,n=sgrud.state.effects,o=n.fetch;return Promise.resolve((0,n.state)("io.github.sgrud.state.config")).then(function(n){return Promise.resolve(o(n.apiUrl+"/users/login",{method:"POST",headers:{accept:"application/json","content-type":"application/json"},body:JSON.stringify({user:{email:e,password:t}})})).then(function(e){function t(t){return Promise.resolve(e.json()).then(function(e){return Object.assign({},r,e.user)})}var n=function(){if(!e.ok)return Promise.resolve(e.json()).then(function(e){throw e})}();return n&&n.then?n.then(t):t()})})}catch(e){return Promise.reject(e)}},r.logout=function(){try{return Promise.resolve(Object.assign({},this,{bio:void 0,email:void 0,image:void 0,password:void 0,token:void 0,username:void 0}))}catch(e){return Promise.reject(e)}},r.register=function(e,t,r){try{var n=this,o=sgrud.state.effects,i=o.fetch;return Promise.resolve((0,o.state)("io.github.sgrud.state.config")).then(function(o){return Promise.resolve(i(o.apiUrl+"/users",{method:"POST",headers:{accept:"application/json","content-type":"application/json"},body:JSON.stringify({user:{email:e,username:t,password:r}})})).then(function(e){function t(t){return Promise.resolve(e.json()).then(function(e){return Object.assign({},n,e.user)})}var r=function(){if(!e.ok)return Promise.resolve(e.json()).then(function(e){throw e})}();return r&&r.then?r.then(t):t()})})}catch(e){return Promise.reject(e)}},r.update=function(e){try{var t=this,r=sgrud.state.effects,n=r.fetch;return Promise.resolve((0,r.state)("io.github.sgrud.state.config")).then(function(r){return Promise.resolve(n(r.apiUrl+"/user",{method:"PUT",headers:{accept:"application/json",authorization:"Token "+t.token,"content-type":"application/json"},body:JSON.stringify({user:e})})).then(function(e){function r(r){return Promise.resolve(e.json()).then(function(e){return Object.assign({},t,e.user)})}var n=function(){if(!e.ok)return Promise.resolve(e.json()).then(function(e){throw e})}();return n&&n.then?n.then(r):r()})})}catch(e){return Promise.reject(e)}},t}(state.Store),_class.handle="io.github.sgrud.state.user",_class),exports.UserStore=UserStore_1=tslib.__decorate([state.Stateful(UserStore_1.handle,{bio:void 0,email:void 0,image:void 0,token:void 0,username:void 0})],exports.UserStore),exports.UserProxy=/*#__PURE__*/function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).configStore=void 0,t.userStore=void 0,t}return _inheritsLoose__default.default(t,e),t.prototype.handle=function(e,t){var r=this;return rxjs.race(state.StateHandler,rxjs.timer(0)).pipe(rxjs.switchMap(function(n){return n instanceof state.StateHandler?rxjs.forkJoin({configState:rxjs.from(r.configStore).pipe(rxjs.first()),userState:rxjs.from(r.userStore).pipe(rxjs.first())}).pipe(rxjs.switchMap(function(r){var n=r.userState;return e.url.startsWith(r.configState.apiUrl)&&n.token&&core.assign(e,{headers:{authorization:"Token "+n.token}}),t.handle(e)})):t.handle(e)}))},t}(core.Provider("sgrud.core.Proxy")),tslib.__decorate([core.Factor(function(){return exports.ConfigStore})],exports.UserProxy.prototype,"configStore",void 0),tslib.__decorate([core.Factor(function(){return exports.UserStore})],exports.UserProxy.prototype,"userStore",void 0),exports.UserProxy=tslib.__decorate([core.Target()],exports.UserProxy),exports.FadeProxy=/*#__PURE__*/function(e){function t(){var t;return t=e.call(this)||this,document.documentElement.style.transition="250ms filter",rxjs.from(_assertThisInitialized__default.default(t)).subscribe(function(e){var t=e.length;document.documentElement.style.filter="grayscale("+(t?1:0)+")",document.documentElement.style.pointerEvents=t?"none":"auto"}),t}return _inheritsLoose__default.default(t,e),t}(core.Transit),exports.FadeProxy=tslib.__decorate([core.Target([],core.Transit)],exports.FadeProxy),exports.FadeQueue=/*#__PURE__*/function(e){function t(){for(var t,r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return(t=e.call.apply(e,[this].concat(n))||this).element=void 0,t}return _inheritsLoose__default.default(t,e),t.prototype.handle=function(e,t,r){var n,o=this;return this.element?((n=this.element.style).transition||(n.transition="opacity 100ms"),this.element.style.opacity="0",rxjs.timer(100).pipe(rxjs.switchMap(function(){return r.handle(t).pipe(rxjs.delay(50))}),rxjs.finalize(function(){return o.element.style.opacity="1"}))):r.handle(t)},t}(core.Provider("sgrud.shell.Queue")),exports.FadeQueue=tslib.__decorate([core.Target()],exports.FadeQueue),exports.Endpoint=Endpoint;
//# sourceMappingURL=index.js.map
