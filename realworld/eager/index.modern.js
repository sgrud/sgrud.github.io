import{__decorate as e}from"tslib";import{jsx as t,Fragment as r,jsxs as i}from"@sgrud/shell/jsx-runtime";import{Factor as s,assign as a,Kernel as l}from"@sgrud/core";import{Router as n,Fluctuate as o,Reference as c,Resolve as d,Route as h,Component as m,html as u,Catch as p}from"@sgrud/shell";import{StateHandler as v}from"@sgrud/state";import{from as f,first as g,switchMap as N,of as b,filter as k,skipWhile as y,map as w}from"rxjs";import{UserStore as S,Endpoint as L,FadeQueue as x}from"sgrud-realworld-core";import{marked as C}from"marked";import A from"@babel/runtime/helpers/extends";function $(e){const{children:s}=e,{body:a,createdAt:l}=e.comment,{image:n,username:o}=e.comment.author,c=`/profile/${o}`;return t(r,{children:i("div",{className:"card",children:[t("div",{className:"card-block",children:t("p",{className:"card-text",children:a})}),i("div",{className:"card-footer",children:[t("a",{className:"comment-author",href:c,is:"router-link",children:t("img",{className:"comment-author-img",src:n})})," ",t("a",{className:"comment-author",href:c,is:"router-link",children:o}),t("span",{className:"date-posted",children:new Date(l).toLocaleString()}),s]})]})})}function F(e){const{children:s}=e,{image:a,username:l}=e.article.author,n=new Date(e.article.createdAt).toLocaleString(),o=`/profile/${l}`;return t(r,{children:i("div",{className:"article-meta",children:[t("a",{href:o,is:"router-link",children:t("img",{src:a})}),i("div",{className:"info",children:[t("a",{className:"author",href:o,is:"router-link",children:l}),t("span",{className:"date",children:n})]}),s]})})}function E(e){const{tagList:i}=e;return t(r,{children:i.length>0&&t(r,{children:t("ul",{className:"tag-list",children:i.map(e=>t(r,{children:t("li",{className:"tag-default tag-outline tag-pill",children:e})}))})})})}function M(e){const{article:s,ondelete:a}=e,l=a.bind(void 0,s);let n="btn btn-sm btn-outline-danger";return e.className&&(n+=` ${e.className}`),t(r,{children:i("button",{className:n,onclick:l,type:"button",children:[t("i",{className:"ion-trash-a"})," Delete Article"]})})}function T(e){const{slug:s}=e.article;let a="btn btn-sm btn-outline-secondary";return e.className&&(a+=` ${e.className}`),t(r,{children:i("a",{className:a,href:`/editor/${s}`,is:"router-link",children:[t("i",{className:"ion-edit"})," Edit Article"]})})}function D(e){const{onfollow:s,profile:a}=e,{username:l,following:n}=a,o=s.bind(void 0,a);let c=`btn btn-sm btn${n?"-":"-outline-"}secondary`;return e.className&&(c+=` ${e.className}`),t(r,{children:i("button",{className:c,onclick:o,type:"button",children:[t("i",{className:"ion-plus-round"})," ",n?"Unfollow":"Follow"," ",l]})})}function H(e){const{article:s,children:a,onlike:l}=e,{favorited:n}=s,o=l.bind(void 0,s);let c=`btn btn-sm btn${n?"-":"-outline-"}primary`;return e.className&&(c+=` ${e.className}`),t(r,{children:i("button",{className:c,onclick:o,type:"button",children:[t("i",{className:"ion-heart"})," ",a]})})}let P=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.userState=void 0,this.form=void 0,this.article=void 0,this.comments=void 0}get template(){var e,s,a,l,n,o;return t(r,{children:i("div",{className:"article-page",children:[t("div",{className:"banner",children:i("div",{className:"container",children:[t("h1",{children:this.article.title}),t(F,{article:this.article,children:this.article.author.username===(null==(e=this.userState)?void 0:e.username)?i(r,{children:[t(T,{article:this.article})," ",t(M,{article:this.article,ondelete:()=>this.removeArticle()})]}):i(r,{children:[t(D,{profile:this.article.author,onfollow:()=>this.updateFollow()})," ",i(H,{article:this.article,onlike:()=>this.updateLike(),children:[this.article.favorited&&null!=(s=this.userState)&&s.token?"Unfavorite":"Favorite"," Article"," ",i("span",{className:"counter",children:["(",this.article.favoritesCount,")"]})]})]})})]})}),i("div",{className:"container page",children:[t("div",{className:"row article-content",children:i("div",{className:"col-md-12",children:[t("div",{children:u(C(this.article.body))}),t(E,{tagList:this.article.tagList})]})}),t("hr",{}),t("div",{className:"article-actions",children:t(F,{article:this.article,children:this.article.author.username===(null==(a=this.userState)?void 0:a.username)?i(r,{children:[t(T,{article:this.article})," ",t(M,{article:this.article,ondelete:()=>this.removeArticle()})]}):i(r,{children:[t(D,{profile:this.article.author,onfollow:()=>this.updateFollow()})," ",i(H,{article:this.article,onlike:()=>this.updateLike(),children:[this.article.favorited&&null!=(l=this.userState)&&l.token?"Unfavorite":"Favorite"," Article"," ",i("span",{className:"counter",children:["(",this.article.favoritesCount,")"]})]})]})})}),t("div",{className:"row",children:i("div",{className:"col-md-8 col-xs-12 offset-md-2",children:[null!=(n=this.userState)&&n.token?t(r,{children:i("form",{className:"card comment-form",children:[t("div",{className:"card-block",children:t("textarea",{className:"form-control",name:"body",placeholder:"Write a comment...",required:!0,rows:3})}),i("div",{className:"card-footer",children:[t("img",{className:"comment-author-img",src:this.userState.image}),t("button",{className:"btn btn-sm btn-primary",disabled:!(null!=(o=this.form)&&o.checkValidity())||void 0,onclick:()=>this.updateComment(),type:"button",children:"Post Comment"})]})]},"form")}):i(r,{children:[t("a",{href:"/login",is:"router-link",children:"Sign in"})," or"," ",t("a",{href:"/register",is:"router-link",children:"sign up"})," ","to add comments on this article."]}),this.comments.map(e=>{var i;return t(r,{children:t($,{comment:e,children:e.author.username===(null==(i=this.userState)?void 0:i.username)&&t(r,{children:t("span",{className:"mod-options",children:t("i",{className:"ion-trash-a",onclick:()=>{this.removeComment(e)}})})})})})})]})})]})]})})}removeArticle(){L.removeArticle(this.article).subscribe(()=>{this.router.navigate(`/profile/${this.userState.username}`).subscribe()})}removeComment(e){L.removeComment(this.article,e).subscribe(()=>{this.comments.splice(this.comments.indexOf(e),1),this.renderComponent()})}updateComment(){const e=new FormData(this.form);L.updateComment(this.article,{body:e.get("body").toString()}).subscribe(e=>{var t;this.comments.unshift(e),this.renderComponent(),null==(t=this.form)||t.reset()})}updateFollow(){var e;null!=(e=this.userState)&&e.token?L.updateFollow(this.article.author).subscribe(e=>{a(this.article.author,e),this.renderComponent()}):this.router.navigate("/login").subscribe()}updateLike(){var e;null!=(e=this.userState)&&e.token?L.updateLike(this.article).subscribe(e=>{a(this.article,e),this.renderComponent()}):this.router.navigate("/login").subscribe()}};e([s(()=>n)],P.prototype,"router",void 0),e([o(()=>new S)],P.prototype,"userState",void 0),e([c("form",["input"])],P.prototype,"form",void 0),e([d(({params:e})=>L.readArticle(e.slug))],P.prototype,"article",void 0),e([d(({params:e})=>L.readComments(e.slug))],P.prototype,"comments",void 0),P=e([h({path:"article/:slug"}),m("article-component")],P);let j=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.error=void 0}get template(){return t(r,{children:t("div",{className:"home-page",children:t("div",{className:"banner",style:{background:"#b85c5c"},children:i("div",{className:"container",children:[t("h1",{className:"logo-font",children:"error"}),i("p",{children:[t("strong",{children:this.error.name}),": ",this.error.message]})]})})})})}connectedCallback(){this.error&&(console.error(this.error),this.renderComponent())}};e([p()],j.prototype,"error",void 0),j=e([h({path:"error"}),m("error-component")],j);let q=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");']}get template(){return t(r,{children:t("footer",{children:i("div",{className:"container",children:[t("a",{className:"logo-font",href:"/",is:"router-link",children:"conduit"}),i("span",{className:"attribution",children:["Â© ",(new Date).getFullYear(),". An interactive learning project from"," ",t("a",{href:"https://thinkster.io",children:"Thinkster"}),". Code licensed under MIT."]})]})})})}};q=e([m("footer-component")],q);let O=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.routerState=void 0,this.userState=void 0}get template(){var e;return t(r,{children:t("nav",{className:"navbar navbar-light",children:i("div",{className:"container",children:[t("a",{className:"navbar-brand",href:"/",is:"router-link",children:"conduit"}),i("ul",{className:"nav navbar-nav pull-xs-right",children:[t("li",{className:"nav-item",children:t("a",A({},this.navLink(),{children:"Home"}))}),null!=(e=this.userState)&&e.token?i(r,{children:[t("li",{className:"nav-item",children:i("a",A({},this.navLink("editor"),{children:[t("i",{className:"ion-compose"})," New Article"]}))}),t("li",{className:"nav-item",children:i("a",A({},this.navLink("settings"),{children:[t("i",{className:"ion-gear-a"})," Settings"]}))}),t("li",{className:"nav-item",children:i("a",A({},this.navLink("profile",this.userState.username),{children:[t("img",{className:"user-pic",src:this.userState.image}),this.userState.username]}))})]}):i(r,{children:[t("li",{className:"nav-item",children:t("a",A({},this.navLink("login"),{children:"Sign in"}))}),t("li",{className:"nav-item",children:t("a",A({},this.navLink("register"),{children:"Sign up"}))})]})]})]})})})}navLink(...e){var t;const r={className:"nav-link",href:`/${e.join("/")}`,is:"router-link"};return(null==(t=this.routerState)?void 0:t.path)===this.router.rebase(r.href,!1)&&(r.className+=" active"),r}};function R(e){const{count:i,limit:s,offset:a,onoffset:l}=e,n=Math.floor(a/s)+1,o=Math.ceil(i/s);return t(r,{children:t("nav",{children:t("ul",{className:"pagination",children:new Array(o).fill(null).map((e,i)=>t(r,{children:t("li",{className:"page-item "+(i+1===n?"active":""),children:t("a",{className:"page-link",href:"#",onclick:e=>{l(i*s),e.preventDefault()},children:i+1})})}))})})})}function U(e){const{article:s,onlike:a}=e,{description:l,favoritesCount:n,slug:o,tagList:c,title:d}=s;return t(r,{children:i("div",{className:"article-preview",children:[t(F,{article:s,children:t(H,{article:s,className:"pull-xs-right",onlike:a,children:n})}),i("a",{className:"preview-link",href:`/article/${o}`,is:"router-link",children:[t("h1",{children:d}),t("p",{children:l}),t("span",{children:"Read more..."}),t(E,{tagList:c})]})]})})}function Q(e){const{articles:s,articlesCount:a,limit:l,offset:n,onlike:o,onoffset:c}=e;return a?i(r,{children:[s.map(e=>t(r,{children:t(U,{article:e,onlike:o})})),s.length<a&&t(r,{children:t(R,{count:a,limit:l,offset:n,onoffset:c})})]}):t(r,{children:t("div",{className:"article-preview",children:"No articles are here... yet."})})}e([s(()=>n)],O.prototype,"router",void 0),e([o(()=>new n)],O.prototype,"routerState",void 0),e([o(()=>new S)],O.prototype,"userState",void 0),O=e([m("header-component")],O);let V=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.userState=void 0,this.articles=void 0,this.tagList=void 0}get template(){var e;return t(r,{children:i("div",{className:"home-page",children:[t("div",{className:"banner",children:i("div",{className:"container",children:[t("h1",{className:"logo-font",children:"conduit"}),i("p",{children:["A place to share your ",t("i",{children:"SGRUD"})," knowledge."]})]})}),t("div",{className:"container page",children:i("div",{className:"row",children:[i("div",{className:"col-md-9",children:[t("div",{className:"feed-toggle",children:i("ul",{className:"nav nav-pills outline-active",children:[(null==(e=this.userState)?void 0:e.token)&&t(r,{children:t("li",{className:"nav-item",children:t("a",A({},this.navLink({path:"feed",tag:void 0}),{children:"Your Feed"}))})}),t("li",{className:"nav-item",children:t("a",A({},this.navLink({path:void 0,tag:void 0}),{children:"Global Feed"}))}),this.articles.tag&&t(r,{children:t("li",{className:"nav-item",children:i("a",A({},this.navLink({path:void 0,tag:this.articles.tag}),{children:[t("i",{className:"ion-pound"})," ",this.articles.tag]}))})})]})}),t(Q,A({},this.articles,{onlike:e=>this.updateLike(e),onoffset:e=>this.readArticles({offset:e})}))]}),t("div",{className:"col-md-3",children:i("div",{className:"sidebar",children:[t("p",{children:"Popular Tags"}),t(r,this.tagList.length>0?{children:t("div",{className:"tag-list",children:this.tagList.map(e=>t(r,{children:t("a",A({},this.navPill(e),{children:e}))}))})}:{children:t("div",{children:"No tags are here... yet."})})]})})]})})]})})}navLink(e){const t={className:"nav-link",href:"#",onclick:t=>{this.readArticles(A({},e,{offset:0})),t.preventDefault()}};return Object.keys(e).every(t=>{var r;return e[t]===(null==(r=this.articles)?void 0:r[t])})&&(t.className+=" active"),t}navPill(e){const t={className:"tag-pill tag-default",href:"#",onclick:t=>{this.readArticles({offset:0,path:void 0,tag:e}),t.preventDefault()}};return e===this.articles.tag&&(t.className+=" active"),t}readArticles(e){const{offset:t,path:r,tag:i}=this.articles;L.readArticles(A({offset:t,path:r,tag:i},e)).subscribe(e=>{this.articles=e,this.renderComponent()})}updateLike(e){var t;null!=(t=this.userState)&&t.token?L.updateLike(e).subscribe(t=>{const r=this.articles.articles.indexOf(e);this.articles.articles.splice(r,1,t),this.renderComponent()}):this.router.navigate("/login").subscribe()}};function Y(e){const{errors:s}=e;return t(r,{children:s&&t(r,{children:t("ul",{className:"error-messages",children:Object.keys(s).map(e=>s[e].map(s=>t(r,{children:i("li",{children:[e," ",s]})})))})})})}e([s(()=>n)],V.prototype,"router",void 0),e([o(()=>new S)],V.prototype,"userState",void 0),e([d(()=>L.readArticles())],V.prototype,"articles",void 0),e([d(()=>L.readTags())],V.prototype,"tagList",void 0),V=e([h({path:""}),m("home-component")],V);let G=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.store=void 0,this.form=void 0,this.errors=void 0}get template(){var e;return t(r,{children:t("div",{className:"auth-page",children:t("div",{className:"container page",children:t("div",{className:"row",children:i("div",{className:"col-md-6 col-xs-12 offset-md-3",children:[t("h1",{className:"text-xs-center",children:"Sign in"}),t("p",{className:"text-xs-center",children:t("a",{href:"/register",is:"router-link",children:"Need an account?"})}),t(Y,{errors:this.errors}),i("form",{children:[t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"email",pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",placeholder:"Email",required:!0,type:"email"})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"password",pattern:"^.{8,}$",placeholder:"Password",required:!0,type:"password"})}),t("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(e=this.form)&&e.checkValidity())||void 0,onclick:()=>this.dispatchLogin(),type:"button",children:"Sign in"})]},"form")]})})})})})}dispatchLogin(){const e=new FormData(this.form);this.errors&&(this.errors=void 0,this.renderComponent()),this.store.dispatch("login",[e.get("email").toString(),e.get("password").toString()]).subscribe({error:({errors:e})=>{this.errors=e,this.renderComponent()},next:({username:e})=>this.router.navigate(`/profile/${e}`).subscribe()})}};e([s(()=>n)],G.prototype,"router",void 0),e([s(()=>S)],G.prototype,"store",void 0),e([c("form",["input"])],G.prototype,"form",void 0),G=e([h({path:"login"}),m("login-component")],G);let z=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.routerState=void 0,this.userState=void 0,this.articles=void 0,this.profile=void 0}get template(){var e;return t(r,{children:i("div",{className:"profile-page",children:[t("div",{className:"user-info",children:t("div",{className:"container",children:t("div",{className:"row",children:i("div",{className:"col-md-10 col-xs-12 offset-md-1",children:[t("img",{className:"user-img",src:this.profile.image}),t("h4",{children:this.profile.username}),t("p",{children:this.profile.bio}),this.profile.username===(null==(e=this.userState)?void 0:e.username)?t(r,{children:i("a",{className:"btn btn-sm btn-outline-secondary action-btn",href:"/settings",is:"router-link",children:[t("i",{className:"ion-gear-a"})," Edit Profile Settings"]})}):t(r,{children:t(D,{className:"action-btn",onfollow:()=>this.updateFollow(),profile:this.profile})})]})})})}),t("div",{className:"container",children:t("div",{className:"row",children:i("div",{className:"col-md-10 col-xs-12 offset-md-1",children:[t("div",{className:"articles-toggle",children:i("ul",{className:"nav nav-pills outline-active",children:[t("li",{className:"nav-item",children:t("a",A({},this.navLink(),{children:"My Articles"}))}),t("li",{className:"nav-item",children:t("a",A({},this.navLink("favorites"),{children:"Favorited Articles"}))})]})}),t(Q,A({},this.articles,{onlike:e=>this.updateLike(e),onoffset:e=>this.readArticles({offset:e})}))]})})})]})})}navLink(...e){var t;const r={className:"nav-link",href:`/profile/${[this.profile.username].concat(e).join("/")}`,is:"router-link"};return(null==(t=this.routerState)?void 0:t.path)===this.router.rebase(r.href,!1)&&(r.className+=" active"),r}readArticles(e){const{author:t,favorited:r,offset:i}=this.articles;L.readArticles(A({author:t,favorited:r,offset:i},e)).subscribe(e=>{this.articles=e,this.renderComponent()})}updateFollow(){var e;null!=(e=this.userState)&&e.token?L.updateFollow(this.profile).subscribe(e=>{a(this.profile,e),this.renderComponent()}):this.router.navigate("/login").subscribe()}updateLike(e){var t;null!=(t=this.userState)&&t.token?L.updateLike(e).subscribe(t=>{const r=this.articles.articles.indexOf(e);this.articles.articles.splice(r,1,t),this.renderComponent()}):this.router.navigate("/login").subscribe()}};e([s(()=>n)],z.prototype,"router",void 0),e([o(()=>new n)],z.prototype,"routerState",void 0),e([o(()=>new S)],z.prototype,"userState",void 0),e([d(({params:e})=>L.readArticles({[e.favorites?"favorited":"author"]:e.username}))],z.prototype,"articles",void 0),e([d(({params:e})=>f(new S).pipe(g(),N(t=>e.username!==t.username?L.readProfile(e.username):b(t))))],z.prototype,"profile",void 0),z=e([h({path:"profile/:username/:favorites?"}),m("profile-component")],z);let I=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.store=void 0,this.form=void 0,this.errors=void 0}get template(){var e;return t(r,{children:t("div",{className:"auth-page",children:t("div",{className:"container page",children:t("div",{className:"row",children:i("div",{className:"col-md-6 col-xs-12 offset-md-3",children:[t("h1",{className:"text-xs-center",children:"Sign up"}),t("p",{className:"text-xs-center",children:t("a",{href:"/login",is:"router-link",children:"Have an account?"})}),t(Y,{errors:this.errors}),i("form",{children:[t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"username",placeholder:"Your Name",required:!0,type:"text"})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"email",pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",placeholder:"Email",required:!0,type:"text"})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"password",pattern:"^.{8,}$",placeholder:"Password",required:!0,type:"password"})}),t("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(e=this.form)&&e.checkValidity())||void 0,onclick:()=>this.dispatchRegister(),type:"button",children:"Sign up"})]},"form")]})})})})})}dispatchRegister(){const e=new FormData(this.form);this.errors&&(this.errors=void 0,this.renderComponent()),this.store.dispatch("register",[e.get("email").toString(),e.get("username").toString(),e.get("password").toString()]).subscribe({error:({errors:e})=>{this.errors=e,this.renderComponent()},next:({username:e})=>this.router.navigate(`/profile/${e}`).subscribe()})}};var W;e([s(()=>n)],I.prototype,"router",void 0),e([s(()=>S)],I.prototype,"store",void 0),e([c("form",["input"])],I.prototype,"form",void 0),I=e([h({path:"register"}),m("register-component")],I);let B=(W=class extends HTMLElement{get template(){return i(r,{children:[t("slot",{name:"header"}),t("main",{children:t("slot",{})},"main"),t("slot",{name:"footer"})]})}constructor(){super(),this.styles=['@import url("/realworld/style.css");'],this.fadeQueue=void 0,this.router=void 0,this.userStore=void 0,this.main=void 0,f(this.userStore).pipe(g(({username:e})=>!!e),N(()=>(new l).require("/realworld/lazy"))).subscribe(),f(this.userStore).pipe(k(()=>!document.hasFocus()),y(({username:e})=>!e),w(({username:e})=>e?`/profile/${e}`:"/login"),N(e=>this.router.navigate(e,void 0,"replace"))).subscribe()}connectedCallback(){f(v).subscribe(()=>{this.renderComponent(),this.fadeQueue.element=this.main})}},new v("/realworld/."),W);e([s(()=>x)],B.prototype,"fadeQueue",void 0),e([s(()=>n)],B.prototype,"router",void 0),e([s(()=>S)],B.prototype,"userStore",void 0),e([c("main")],B.prototype,"main",void 0),B=e([h({path:"",children:[P,j,V,G,z,I],slots:{header:O,footer:q}}),m("app-component")],B);export{B as AppComponent,$ as ArticleComment,P as ArticleComponent,Q as ArticleList,F as ArticleMeta,R as ArticlePager,U as ArticlePreview,E as ArticleTags,M as DeleteButton,T as EditButton,j as ErrorComponent,Y as ErrorMessages,D as FollowButton,q as FooterComponent,O as HeaderComponent,V as HomeComponent,H as LikeButton,G as LoginComponent,z as ProfileComponent,I as RegisterComponent};
//# sourceMappingURL=index.modern.js.map
