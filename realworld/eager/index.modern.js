import{__decorate as e}from"tslib";import{jsx as i,Fragment as r,jsxs as t}from"@sgrud/shell/jsx-runtime";import{Factor as s}from"@sgrud/core";import{Route as a,Component as n,Router as l,Reference as o}from"@sgrud/shell";import{Credentials as c,Endpoint as d,FadeTask as h}from"sgrud-realworld-core";import m from"@babel/runtime/helpers/extends";import{from as p,takeWhile as u,merge as g}from"rxjs";let v=class extends HTMLElement{get template(){return i(r,{children:t("div",{className:"home-page",children:[i("div",{className:"banner",children:t("div",{className:"container",children:[i("h1",{className:"logo-font",children:"conduit"}),t("p",{children:["A place to share your ",i("i",{children:"SGRUD"})," knowledge."]})]})}),t("div",{className:"container page",children:[t("div",{className:"row",children:[t("div",{className:"col-md-9",children:[i("div",{className:"feed-toggle",children:t("ul",{className:"nav nav-pills outline-active",children:[i("li",{className:"nav-item",children:i("a",m({},this.tabbing("articles/feed"),{children:"Your Feed"}))}),i("li",{className:"nav-item",children:i("a",m({},this.tabbing("articles"),{children:"Global Feed"}))}),this.tag&&i(r,{children:i("li",{className:"nav-item",children:t("a",m({},this.tabbing(`articles?tag=${this.tag}`),{children:[i("i",{className:"ion-pound"})," ",this.tag]}))})})]})}),this.articles?0===this.articles.length?i(r,{children:i("div",{className:"article-preview",children:"No articles are here... yet."})}):this.articles.map(e=>i(r,{children:t("div",{className:"article-preview",children:[t("div",{className:"article-meta",children:[i("a",{href:`/profile/${e.author.username}`,is:"router-link",children:i("img",{src:e.author.image})}),t("div",{className:"info",children:[i("a",{className:"author",href:`/profile/${e.author.username}`,is:"router-link",children:e.author.username}),i("span",{className:"date",children:new Date(e.createdAt).toLocaleString()})]}),t("button",{className:"btn btn-sm btn-outline-primary pull-xs-right",children:[i("i",{className:"ion-heart"})," ",e.favoritesCount]})]}),t("a",{className:"preview-link",href:`/article/${e.slug}`,is:"router-link",children:[i("h1",{children:e.title}),i("p",{children:e.description}),i("span",{children:"Read more..."}),e.tagList.map(e=>i(r,{children:i("li",{className:"tag-default tag-outline tag-pill",children:e})}))]})]})})):i(r,{children:i("div",{className:"article-preview",children:"Loading articles..."})})]}),i("div",{className:"col-md-3",children:t("div",{className:"sidebar",children:[i("p",{children:"Popular Tags"}),i(r,this.tags?0===this.tags.length?{children:i("div",{children:"No tags are here... yet."})}:{children:i("div",{className:"tag-list",children:this.tags.map(e=>i(r,{children:i("a",m({},this.tagging(e),{children:e}))}))})}:{children:i("div",{children:"Loading tags..."})})]})})]}),this.pages>1&&i(r,{children:i("nav",{children:i("ul",{className:"pagination",children:new Array(this.pages).fill(null).map((e,t)=>i(r,{children:i("li",{className:"active page-item",children:i("a",m({},this.paging(t),{children:t+1}))})}))})})})]})]})})}constructor(){super(),this.styles=['@import url("//demo.productionready.io/main.css");'],this.credentials=void 0,this.endpoint=void 0,this.articles=void 0,this.from="articles",this.page=0,this.pages=1,this.tag=void 0,this.tags=void 0,this.fetch(),this.endpoint.getTags().subscribe(e=>{var i;this.tags=e,null==(i=this.renderComponent)||i.call(this)})}fetch(e=this.page,i=this.from){const r=10*e;var t;this.from=i,this.page=e,this.articles&&(this.articles=void 0,null==(t=this.renderComponent)||t.call(this)),this.endpoint.getPage(i,10,r).subscribe(e=>{var i;this.articles=e.articles,this.pages=Math.ceil(e.articlesCount/10),null==(i=this.renderComponent)||i.call(this)})}paging(e){const i={className:"page-link",href:"#",onclick:i=>{i.preventDefault(),e!==this.page&&this.fetch(e)}};return e===this.page&&(i.className+=" active"),i}tabbing(e){const i={className:"nav-link",href:"#",onclick:i=>{i.preventDefault(),"articles/feed"!==e||this.credentials.user?e!==this.from&&this.fetch(0,e):console.log("TODO","REDIRECT","/login")}};return e===this.from?i.className+=" active":"articles/feed"!==e||this.credentials.user||(i.className+=" disabled"),i}tagging(e){const i={className:"tag-pill tag-default",href:"#",onclick:i=>{i.preventDefault(),e!==this.tag&&(this.tag=e,this.fetch(0,`articles?tag=${this.tag}`))}};return e===this.tag&&(i.className+=" active"),i}};e([s(()=>c)],v.prototype,"credentials",void 0),e([s(()=>d)],v.prototype,"endpoint",void 0),v=e([a({path:""}),n("home-component")],v);let f=class extends HTMLElement{get template(){var e;return i(r,{children:i("div",{className:"auth-page",children:i("div",{className:"container page",children:i("div",{className:"row",children:t("div",{className:"col-md-6 col-xs-12 offset-md-3",children:[i("h1",{className:"text-xs-center",children:"Sign in"}),i("p",{className:"text-xs-center",children:i("a",{href:"/register",is:"router-link",children:"Need an account?"})}),this.errors.length>0&&i(r,{children:i("ul",{className:"error-messages",children:this.errors.map(e=>i(r,{children:i("li",{children:e})}))})}),t("form",{children:[i("fieldset",{className:"form-group",children:i("input",{className:"form-control form-control-lg",name:"email",pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",placeholder:"Email",required:!0,type:"email"})}),i("fieldset",{className:"form-group",children:i("input",{className:"form-control form-control-lg",name:"password",pattern:"^.{8,}$",placeholder:"Password",required:!0,type:"password"})}),i("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(e=this.form)&&e.checkValidity())||void 0,onclick:()=>this.login(),type:"button",children:"Sign in"})]},"form")]})})})})})}constructor(){super(),this.styles=['@import url("//demo.productionready.io/main.css");'],this.credentials=void 0,this.endpoint=void 0,this.router=void 0,this.form=void 0,this.errors=[],p(this.credentials).pipe(u(()=>this.isConnected)).subscribe(({username:e})=>{this.router.navigate("/profile/"+e,void 0,!0).subscribe()})}login(){const e=new FormData(this.form);this.errors.length&&(this.errors.length=0,this.renderComponent()),this.endpoint.login(e.get("email").toString(),e.get("password").toString()).subscribe({error:({response:e})=>{for(const i in e.errors)for(const r of e.errors[i])this.errors.push(`${i} ${r}`);this.renderComponent()}})}};e([s(()=>c)],f.prototype,"credentials",void 0),e([s(()=>d)],f.prototype,"endpoint",void 0),e([s(()=>l)],f.prototype,"router",void 0),e([o("form",["input"])],f.prototype,"form",void 0),f=e([a({path:"login"}),n("login-component")],f);let N=class extends HTMLElement{get template(){var e;return i(r,{children:i("div",{className:"auth-page",children:i("div",{className:"container page",children:i("div",{className:"row",children:t("div",{className:"col-md-6 col-xs-12 offset-md-3",children:[i("h1",{className:"text-xs-center",children:"Sign up"}),i("p",{className:"text-xs-center",children:i("a",{href:"/login",is:"router-link",children:"Have an account?"})}),this.errors.length>0&&i(r,{children:i("ul",{className:"error-messages",children:this.errors.map(e=>i(r,{children:i("li",{children:e})}))})}),t("form",{children:[i("fieldset",{className:"form-group",children:i("input",{className:"form-control form-control-lg",name:"username",placeholder:"Your Name",required:!0,type:"text"})}),i("fieldset",{className:"form-group",children:i("input",{className:"form-control form-control-lg",name:"email",pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",placeholder:"Email",required:!0,type:"text"})}),i("fieldset",{className:"form-group",children:i("input",{className:"form-control form-control-lg",name:"password",pattern:"^.{8,}$",placeholder:"Password",required:!0,type:"password"})}),i("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(e=this.form)&&e.checkValidity())||void 0,onclick:()=>this.register(),type:"button",children:"Sign up"})]},"form")]})})})})})}constructor(){super(),this.styles=['@import url("//demo.productionready.io/main.css");'],this.credentials=void 0,this.endpoint=void 0,this.router=void 0,this.form=void 0,this.errors=[],p(this.credentials).pipe(u(()=>this.isConnected)).subscribe(({username:e})=>{this.router.navigate("/profile/"+e,void 0,!0).subscribe()})}register(){const e=new FormData(this.form);this.errors.length&&(this.errors.length=0,this.renderComponent()),this.endpoint.register(e.get("email").toString(),e.get("username").toString(),e.get("password").toString()).subscribe({error:({response:e})=>{for(const i in e.errors)for(const r of e.errors[i])this.errors.push(`${i} ${r}`);this.renderComponent()}})}};e([s(()=>c)],N.prototype,"credentials",void 0),e([s(()=>d)],N.prototype,"endpoint",void 0),e([s(()=>l)],N.prototype,"router",void 0),e([o("form",["input"])],N.prototype,"form",void 0),N=e([a({path:"register"}),n("register-component")],N);let b=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("//demo.productionready.io/main.css");'],this.fadeTask=void 0,this.main=void 0}get template(){return t(r,{children:[i("slot",{name:"header"}),i("main",{children:i("slot",{children:"Loading route..."})},"main"),i("slot",{name:"footer"})]})}connectedCallback(){this.renderComponent(),this.fadeTask.element=this.main}};e([s(()=>h)],b.prototype,"fadeTask",void 0),e([o("main")],b.prototype,"main",void 0),b=e([a({path:"",children:[v,f,N],slots:{header:"header-component",footer:"footer-component"}}),n("app-component")],b);let y=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("//demo.productionready.io/main.css");']}get template(){return i(r,{children:i("footer",{children:t("div",{className:"container",children:[i("a",{className:"logo-font",href:"/",is:"router-link",children:"conduit"}),t("span",{className:"attribution",children:["An interactive learning project from",i("a",{href:"https://thinkster.io",children:"Thinkster"}),". Code & design licensed under MIT."]})]})})})}};y=e([n("footer-component")],y);let k=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("//demo.productionready.io/main.css");'],this.credentials=void 0,this.router=void 0}get template(){var e;return i(r,{children:i("nav",{className:"navbar navbar-light",children:t("div",{className:"container",children:[i("a",{className:"navbar-brand",href:"/",is:"router-link",children:"conduit"}),t("ul",{className:"nav navbar-nav pull-xs-right",children:[i("li",{className:"nav-item",children:i("a",m({is:"router-link"},this.navLink(),{children:"Home"}))}),null!=(e=this.credentials.user)&&e.token?t(r,{children:[i("li",{className:"nav-item",children:t("a",m({is:"router-link"},this.navLink("editor"),{children:[i("i",{className:"ion-compose"})," New Article"]}))}),i("li",{className:"nav-item",children:t("a",m({is:"router-link"},this.navLink("settings"),{children:[i("i",{className:"ion-gear-a"})," Settings"]}))}),i("li",{className:"nav-item",children:t("a",m({is:"router-link"},this.navLink("profile",this.credentials.user.username),{children:[i("img",{alt:"user image",className:"user-pic",src:this.credentials.user.image}),this.credentials.user.username]}))})]}):t(r,{children:[i("li",{className:"nav-item",children:i("a",m({is:"router-link"},this.navLink("login"),{children:"Sign in"}))}),i("li",{className:"nav-item",children:i("a",m({is:"router-link"},this.navLink("register"),{children:"Sign up"}))})]})]})]})})})}connectedCallback(){g(p(this.credentials),p(this.router)).subscribe(()=>{this.renderComponent()})}navLink(...e){const i="/"+e.join("/"),r={className:"nav-link",href:i};return this.router.rebase(i,!1)===this.router.state.path&&(r.className+=" active"),r}};e([s(()=>c)],k.prototype,"credentials",void 0),e([s(()=>l)],k.prototype,"router",void 0),k=e([n("header-component")],k);export{b as AppComponent,y as FooterComponent,k as HeaderComponent,v as HomeComponent,f as LoginComponent,N as RegisterComponent};
//# sourceMappingURL=index.modern.js.map
