import{__decorate as e}from"tslib";import{jsx as t,Fragment as r,jsxs as i}from"@sgrud/shell/jsx-runtime";import{BusHandler as s}from"@sgrud/bus";import{Factor as a,assign as l,Kernel as n}from"@sgrud/core";import{Router as o,Fluctuate as c,Reference as d,Resolve as h,Route as m,Component as u,html as p,Catch as v}from"@sgrud/shell";import{StateHandler as f}from"@sgrud/state";import{from as g,first as N,switchMap as b,of as k,filter as y,skipWhile as w,map as S}from"rxjs";import{UserStore as L,Endpoint as x,FadeQueue as C}from"sgrud-realworld-core";import{marked as A}from"marked";import $ from"@babel/runtime/helpers/extends";function F(e){const{children:s}=e,{body:a,createdAt:l}=e.comment,{image:n,username:o}=e.comment.author,c=`/profile/${o}`;return t(r,{children:i("div",{className:"card",children:[t("div",{className:"card-block",children:t("p",{className:"card-text",children:a})}),i("div",{className:"card-footer",children:[t("a",{className:"comment-author",href:c,is:"router-link",children:t("img",{className:"comment-author-img",src:n})})," ",t("a",{className:"comment-author",href:c,is:"router-link",children:o}),t("span",{className:"date-posted",children:new Date(l).toLocaleString()}),s]})]})})}function E(e){const{children:s}=e,{image:a,username:l}=e.article.author,n=new Date(e.article.createdAt).toLocaleString(),o=`/profile/${l}`;return t(r,{children:i("div",{className:"article-meta",children:[t("a",{href:o,is:"router-link",children:t("img",{src:a})}),i("div",{className:"info",children:[t("a",{className:"author",href:o,is:"router-link",children:l}),t("span",{className:"date",children:n})]}),s]})})}function M(e){const{tagList:i}=e;return t(r,{children:i.length>0&&t(r,{children:t("ul",{className:"tag-list",children:i.map(e=>t(r,{children:t("li",{className:"tag-default tag-outline tag-pill",children:e})}))})})})}function T(e){const{article:s,ondelete:a}=e,l=a.bind(void 0,s);let n="btn btn-sm btn-outline-danger";return e.className&&(n+=` ${e.className}`),t(r,{children:i("button",{className:n,onclick:l,type:"button",children:[t("i",{className:"ion-trash-a"})," Delete Article"]})})}function D(e){const{slug:s}=e.article;let a="btn btn-sm btn-outline-secondary";return e.className&&(a+=` ${e.className}`),t(r,{children:i("a",{className:a,href:`/editor/${s}`,is:"router-link",children:[t("i",{className:"ion-edit"})," Edit Article"]})})}function H(e){const{onfollow:s,profile:a}=e,{username:l,following:n}=a,o=s.bind(void 0,a);let c=`btn btn-sm btn${n?"-":"-outline-"}secondary`;return e.className&&(c+=` ${e.className}`),t(r,{children:i("button",{className:c,onclick:o,type:"button",children:[t("i",{className:"ion-plus-round"})," ",n?"Unfollow":"Follow"," ",l]})})}function P(e){const{article:s,children:a,onlike:l}=e,{favorited:n}=s,o=l.bind(void 0,s);let c=`btn btn-sm btn${n?"-":"-outline-"}primary`;return e.className&&(c+=` ${e.className}`),t(r,{children:i("button",{className:c,onclick:o,type:"button",children:[t("i",{className:"ion-heart"})," ",a]})})}let j=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.userState=void 0,this.form=void 0,this.article=void 0,this.comments=void 0}get template(){var e,s,a,l,n,o;return t(r,{children:i("div",{className:"article-page",children:[t("div",{className:"banner",children:i("div",{className:"container",children:[t("h1",{children:this.article.title}),t(E,{article:this.article,children:this.article.author.username===(null==(e=this.userState)?void 0:e.username)?i(r,{children:[t(D,{article:this.article})," ",t(T,{article:this.article,ondelete:()=>this.removeArticle()})]}):i(r,{children:[t(H,{profile:this.article.author,onfollow:()=>this.updateFollow()})," ",i(P,{article:this.article,onlike:()=>this.updateLike(),children:[this.article.favorited&&null!=(s=this.userState)&&s.token?"Unfavorite":"Favorite"," Article"," ",i("span",{className:"counter",children:["(",this.article.favoritesCount,")"]})]})]})})]})}),i("div",{className:"container page",children:[t("div",{className:"row article-content",children:i("div",{className:"col-md-12",children:[t("div",{children:p(A(this.article.body))}),t(M,{tagList:this.article.tagList})]})}),t("hr",{}),t("div",{className:"article-actions",children:t(E,{article:this.article,children:this.article.author.username===(null==(a=this.userState)?void 0:a.username)?i(r,{children:[t(D,{article:this.article})," ",t(T,{article:this.article,ondelete:()=>this.removeArticle()})]}):i(r,{children:[t(H,{profile:this.article.author,onfollow:()=>this.updateFollow()})," ",i(P,{article:this.article,onlike:()=>this.updateLike(),children:[this.article.favorited&&null!=(l=this.userState)&&l.token?"Unfavorite":"Favorite"," Article"," ",i("span",{className:"counter",children:["(",this.article.favoritesCount,")"]})]})]})})}),t("div",{className:"row",children:i("div",{className:"col-md-8 col-xs-12 offset-md-2",children:[null!=(n=this.userState)&&n.token?t(r,{children:i("form",{className:"card comment-form",children:[t("div",{className:"card-block",children:t("textarea",{className:"form-control",name:"body",placeholder:"Write a comment...",required:!0,rows:3})}),i("div",{className:"card-footer",children:[t("img",{className:"comment-author-img",src:this.userState.image}),t("button",{className:"btn btn-sm btn-primary",disabled:!(null!=(o=this.form)&&o.checkValidity())||void 0,onclick:()=>this.updateComment(),type:"button",children:"Post Comment"})]})]},"form")}):i(r,{children:[t("a",{href:"/login",is:"router-link",children:"Sign in"})," or"," ",t("a",{href:"/register",is:"router-link",children:"sign up"})," ","to add comments on this article."]}),this.comments.map(e=>{var i;return t(r,{children:t(F,{comment:e,children:e.author.username===(null==(i=this.userState)?void 0:i.username)&&t(r,{children:t("span",{className:"mod-options",children:t("i",{className:"ion-trash-a",onclick:()=>{this.removeComment(e)}})})})})})})]})})]})]})})}removeArticle(){x.removeArticle(this.article).subscribe(()=>{this.router.navigate(`/profile/${this.userState.username}`).subscribe()})}removeComment(e){x.removeComment(this.article,e).subscribe(()=>{this.comments.splice(this.comments.indexOf(e),1),this.renderComponent()})}updateComment(){const e=new FormData(this.form);x.updateComment(this.article,{body:e.get("body").toString()}).subscribe(e=>{var t;this.comments.unshift(e),this.renderComponent(),null==(t=this.form)||t.reset()})}updateFollow(){var e;null!=(e=this.userState)&&e.token?x.updateFollow(this.article.author).subscribe(e=>{l(this.article.author,e),this.renderComponent()}):this.router.navigate("/login").subscribe()}updateLike(){var e;null!=(e=this.userState)&&e.token?x.updateLike(this.article).subscribe(e=>{l(this.article,e),this.renderComponent()}):this.router.navigate("/login").subscribe()}};e([a(()=>o)],j.prototype,"router",void 0),e([c(()=>new L)],j.prototype,"userState",void 0),e([d("form",["input"])],j.prototype,"form",void 0),e([h(({params:e})=>x.readArticle(e.slug))],j.prototype,"article",void 0),e([h(({params:e})=>x.readComments(e.slug))],j.prototype,"comments",void 0),j=e([m({path:"article/:slug"}),u("article-component")],j);let q=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.error=void 0}get template(){return t(r,{children:t("div",{className:"home-page",children:t("div",{className:"banner",style:{background:"#b85c5c"},children:i("div",{className:"container",children:[t("h1",{className:"logo-font",children:"error"}),i("p",{children:[t("strong",{children:this.error.name}),": ",this.error.message]})]})})})})}connectedCallback(){this.error&&(console.error(this.error),this.renderComponent())}};e([v()],q.prototype,"error",void 0),q=e([m({path:"error"}),u("error-component")],q);let O=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");']}get template(){return t(r,{children:t("footer",{children:i("div",{className:"container",children:[t("a",{className:"logo-font",href:"/",is:"router-link",children:"conduit"}),i("span",{className:"attribution",children:["Â© ",(new Date).getFullYear(),". An interactive learning project from"," ",t("a",{href:"https://thinkster.io",children:"Thinkster"}),". Code licensed under MIT."]})]})})})}};O=e([u("footer-component")],O);let R=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.routerState=void 0,this.userState=void 0}get template(){var e;return t(r,{children:t("nav",{className:"navbar navbar-light",children:i("div",{className:"container",children:[t("a",{className:"navbar-brand",href:"/",is:"router-link",children:"conduit"}),i("ul",{className:"nav navbar-nav pull-xs-right",children:[t("li",{className:"nav-item",children:t("a",$({},this.navLink(),{children:"Home"}))}),null!=(e=this.userState)&&e.token?i(r,{children:[t("li",{className:"nav-item",children:i("a",$({},this.navLink("editor"),{children:[t("i",{className:"ion-compose"})," New Article"]}))}),t("li",{className:"nav-item",children:i("a",$({},this.navLink("settings"),{children:[t("i",{className:"ion-gear-a"})," Settings"]}))}),t("li",{className:"nav-item",children:i("a",$({},this.navLink("profile",this.userState.username),{children:[t("img",{className:"user-pic",src:this.userState.image}),this.userState.username]}))})]}):i(r,{children:[t("li",{className:"nav-item",children:t("a",$({},this.navLink("login"),{children:"Sign in"}))}),t("li",{className:"nav-item",children:t("a",$({},this.navLink("register"),{children:"Sign up"}))})]})]})]})})})}navLink(...e){var t;const r={className:"nav-link",href:`/${e.join("/")}`,is:"router-link"};return(null==(t=this.routerState)?void 0:t.path)===this.router.rebase(r.href,!1)&&(r.className+=" active"),r}};function U(e){const{count:i,limit:s,offset:a,onoffset:l}=e,n=Math.floor(a/s)+1,o=Math.ceil(i/s);return t(r,{children:t("nav",{children:t("ul",{className:"pagination",children:new Array(o).fill(null).map((e,i)=>t(r,{children:t("li",{className:"page-item "+(i+1===n?"active":""),children:t("a",{className:"page-link",href:"#",onclick:e=>{l(i*s),e.preventDefault()},children:i+1})})}))})})})}function Q(e){const{article:s,onlike:a}=e,{description:l,favoritesCount:n,slug:o,tagList:c,title:d}=s;return t(r,{children:i("div",{className:"article-preview",children:[t(E,{article:s,children:t(P,{article:s,className:"pull-xs-right",onlike:a,children:n})}),i("a",{className:"preview-link",href:`/article/${o}`,is:"router-link",children:[t("h1",{children:d}),t("p",{children:l}),t("span",{children:"Read more..."}),t(M,{tagList:c})]})]})})}function V(e){const{articles:s,articlesCount:a,limit:l,offset:n,onlike:o,onoffset:c}=e;return a?i(r,{children:[s.map(e=>t(r,{children:t(Q,{article:e,onlike:o})})),s.length<a&&t(r,{children:t(U,{count:a,limit:l,offset:n,onoffset:c})})]}):t(r,{children:t("div",{className:"article-preview",children:"No articles are here... yet."})})}e([a(()=>o)],R.prototype,"router",void 0),e([c(()=>new o)],R.prototype,"routerState",void 0),e([c(()=>new L)],R.prototype,"userState",void 0),R=e([u("header-component")],R);let Y=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.userState=void 0,this.articles=void 0,this.tagList=void 0}get template(){var e;return t(r,{children:i("div",{className:"home-page",children:[t("div",{className:"banner",children:i("div",{className:"container",children:[t("h1",{className:"logo-font",children:"conduit"}),i("p",{children:["A place to share your ",t("i",{children:"SGRUD"})," knowledge."]})]})}),t("div",{className:"container page",children:i("div",{className:"row",children:[i("div",{className:"col-md-9",children:[t("div",{className:"feed-toggle",children:i("ul",{className:"nav nav-pills outline-active",children:[(null==(e=this.userState)?void 0:e.token)&&t(r,{children:t("li",{className:"nav-item",children:t("a",$({},this.navLink({path:"feed",tag:void 0}),{children:"Your Feed"}))})}),t("li",{className:"nav-item",children:t("a",$({},this.navLink({path:void 0,tag:void 0}),{children:"Global Feed"}))}),this.articles.tag&&t(r,{children:t("li",{className:"nav-item",children:i("a",$({},this.navLink({path:void 0,tag:this.articles.tag}),{children:[t("i",{className:"ion-pound"})," ",this.articles.tag]}))})})]})}),t(V,$({},this.articles,{onlike:e=>this.updateLike(e),onoffset:e=>this.readArticles({offset:e})}))]}),t("div",{className:"col-md-3",children:i("div",{className:"sidebar",children:[t("p",{children:"Popular Tags"}),t(r,this.tagList.length>0?{children:t("div",{className:"tag-list",children:this.tagList.map(e=>t(r,{children:t("a",$({},this.navPill(e),{children:e}))}))})}:{children:t("div",{children:"No tags are here... yet."})})]})})]})})]})})}navLink(e){const t={className:"nav-link",href:"#",onclick:t=>{this.readArticles($({},e,{offset:0})),t.preventDefault()}};return Object.keys(e).every(t=>{var r;return e[t]===(null==(r=this.articles)?void 0:r[t])})&&(t.className+=" active"),t}navPill(e){const t={className:"tag-pill tag-default",href:"#",onclick:t=>{this.readArticles({offset:0,path:void 0,tag:e}),t.preventDefault()}};return e===this.articles.tag&&(t.className+=" active"),t}readArticles(e){const{offset:t,path:r,tag:i}=this.articles;x.readArticles($({offset:t,path:r,tag:i},e)).subscribe(e=>{this.articles=e,this.renderComponent()})}updateLike(e){var t;null!=(t=this.userState)&&t.token?x.updateLike(e).subscribe(t=>{const r=this.articles.articles.indexOf(e);this.articles.articles.splice(r,1,t),this.renderComponent()}):this.router.navigate("/login").subscribe()}};function G(e){const{errors:s}=e;return t(r,{children:s&&t(r,{children:t("ul",{className:"error-messages",children:Object.keys(s).map(e=>s[e].map(s=>t(r,{children:i("li",{children:[e," ",s]})})))})})})}e([a(()=>o)],Y.prototype,"router",void 0),e([c(()=>new L)],Y.prototype,"userState",void 0),e([h(()=>x.readArticles())],Y.prototype,"articles",void 0),e([h(()=>x.readTags())],Y.prototype,"tagList",void 0),Y=e([m({path:""}),u("home-component")],Y);let z=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.store=void 0,this.form=void 0,this.errors=void 0}get template(){var e;return t(r,{children:t("div",{className:"auth-page",children:t("div",{className:"container page",children:t("div",{className:"row",children:i("div",{className:"col-md-6 col-xs-12 offset-md-3",children:[t("h1",{className:"text-xs-center",children:"Sign in"}),t("p",{className:"text-xs-center",children:t("a",{href:"/register",is:"router-link",children:"Need an account?"})}),t(G,{errors:this.errors}),i("form",{children:[t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"email",pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",placeholder:"Email",required:!0,type:"email"})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"password",pattern:"^.{8,}$",placeholder:"Password",required:!0,type:"password"})}),t("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(e=this.form)&&e.checkValidity())||void 0,onclick:()=>this.dispatchLogin(),type:"button",children:"Sign in"})]},"form")]})})})})})}dispatchLogin(){const e=new FormData(this.form);this.errors&&(this.errors=void 0,this.renderComponent()),this.store.dispatch("login",[e.get("email").toString(),e.get("password").toString()]).subscribe({error:({errors:e})=>{this.errors=e,this.renderComponent()},next:({username:e})=>this.router.navigate(`/profile/${e}`).subscribe()})}};e([a(()=>o)],z.prototype,"router",void 0),e([a(()=>L)],z.prototype,"store",void 0),e([d("form",["input"])],z.prototype,"form",void 0),z=e([m({path:"login"}),u("login-component")],z);let I=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.routerState=void 0,this.userState=void 0,this.articles=void 0,this.profile=void 0}get template(){var e;return t(r,{children:i("div",{className:"profile-page",children:[t("div",{className:"user-info",children:t("div",{className:"container",children:t("div",{className:"row",children:i("div",{className:"col-md-10 col-xs-12 offset-md-1",children:[t("img",{className:"user-img",src:this.profile.image}),t("h4",{children:this.profile.username}),t("p",{children:this.profile.bio}),this.profile.username===(null==(e=this.userState)?void 0:e.username)?t(r,{children:i("a",{className:"btn btn-sm btn-outline-secondary action-btn",href:"/settings",is:"router-link",children:[t("i",{className:"ion-gear-a"})," Edit Profile Settings"]})}):t(r,{children:t(H,{className:"action-btn",onfollow:()=>this.updateFollow(),profile:this.profile})})]})})})}),t("div",{className:"container",children:t("div",{className:"row",children:i("div",{className:"col-md-10 col-xs-12 offset-md-1",children:[t("div",{className:"articles-toggle",children:i("ul",{className:"nav nav-pills outline-active",children:[t("li",{className:"nav-item",children:t("a",$({},this.navLink(),{children:"My Articles"}))}),t("li",{className:"nav-item",children:t("a",$({},this.navLink("favorites"),{children:"Favorited Articles"}))})]})}),t(V,$({},this.articles,{onlike:e=>this.updateLike(e),onoffset:e=>this.readArticles({offset:e})}))]})})})]})})}navLink(...e){var t;const r={className:"nav-link",href:`/profile/${[this.profile.username].concat(e).join("/")}`,is:"router-link"};return(null==(t=this.routerState)?void 0:t.path)===this.router.rebase(r.href,!1)&&(r.className+=" active"),r}readArticles(e){const{author:t,favorited:r,offset:i}=this.articles;x.readArticles($({author:t,favorited:r,offset:i},e)).subscribe(e=>{this.articles=e,this.renderComponent()})}updateFollow(){var e;null!=(e=this.userState)&&e.token?x.updateFollow(this.profile).subscribe(e=>{l(this.profile,e),this.renderComponent()}):this.router.navigate("/login").subscribe()}updateLike(e){var t;null!=(t=this.userState)&&t.token?x.updateLike(e).subscribe(t=>{const r=this.articles.articles.indexOf(e);this.articles.articles.splice(r,1,t),this.renderComponent()}):this.router.navigate("/login").subscribe()}};e([a(()=>o)],I.prototype,"router",void 0),e([c(()=>new o)],I.prototype,"routerState",void 0),e([c(()=>new L)],I.prototype,"userState",void 0),e([h(({params:e})=>x.readArticles({[e.favorites?"favorited":"author"]:e.username}))],I.prototype,"articles",void 0),e([h(({params:e})=>g(new L).pipe(N(),b(t=>e.username!==t.username?x.readProfile(e.username):k(t))))],I.prototype,"profile",void 0),I=e([m({path:"profile/:username/:favorites?"}),u("profile-component")],I);let W=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.store=void 0,this.form=void 0,this.errors=void 0}get template(){var e;return t(r,{children:t("div",{className:"auth-page",children:t("div",{className:"container page",children:t("div",{className:"row",children:i("div",{className:"col-md-6 col-xs-12 offset-md-3",children:[t("h1",{className:"text-xs-center",children:"Sign up"}),t("p",{className:"text-xs-center",children:t("a",{href:"/login",is:"router-link",children:"Have an account?"})}),t(G,{errors:this.errors}),i("form",{children:[t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"username",placeholder:"Your Name",required:!0,type:"text"})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"email",pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",placeholder:"Email",required:!0,type:"text"})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"password",pattern:"^.{8,}$",placeholder:"Password",required:!0,type:"password"})}),t("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(e=this.form)&&e.checkValidity())||void 0,onclick:()=>this.dispatchRegister(),type:"button",children:"Sign up"})]},"form")]})})})})})}dispatchRegister(){const e=new FormData(this.form);this.errors&&(this.errors=void 0,this.renderComponent()),this.store.dispatch("register",[e.get("email").toString(),e.get("username").toString(),e.get("password").toString()]).subscribe({error:({errors:e})=>{this.errors=e,this.renderComponent()},next:({username:e})=>this.router.navigate(`/profile/${e}`).subscribe()})}};var B;e([a(()=>o)],W.prototype,"router",void 0),e([a(()=>L)],W.prototype,"store",void 0),e([d("form",["input"])],W.prototype,"form",void 0),W=e([m({path:"register"}),u("register-component")],W);let J=(B=class extends HTMLElement{get template(){return i(r,{children:[t("slot",{name:"header"}),t("main",{children:t("slot",{})},"main"),t("slot",{name:"footer"})]})}constructor(){super(),this.styles=['@import url("/realworld/style.css");'],this.fadeQueue=void 0,this.router=void 0,this.userStore=void 0,this.main=void 0,g(this.userStore).pipe(N(({username:e})=>!!e),b(()=>(new n).require("/realworld/lazy"))).subscribe(),g(this.userStore).pipe(y(()=>!document.hasFocus()),w(({username:e})=>!e),S(({username:e})=>e?`/profile/${e}`:"/login"),b(e=>this.router.navigate(e,void 0,"replace"))).subscribe()}connectedCallback(){g(f).subscribe(()=>{this.renderComponent(),this.fadeQueue.element=this.main})}},new s("/realworld/worker"),new f("/realworld/."),B);e([a(()=>C)],J.prototype,"fadeQueue",void 0),e([a(()=>o)],J.prototype,"router",void 0),e([a(()=>L)],J.prototype,"userStore",void 0),e([d("main")],J.prototype,"main",void 0),J=e([m({path:"",children:[j,q,Y,z,I,W],slots:{header:R,footer:O}}),u("app-component")],J);export{J as AppComponent,F as ArticleComment,j as ArticleComponent,V as ArticleList,E as ArticleMeta,U as ArticlePager,Q as ArticlePreview,M as ArticleTags,T as DeleteButton,D as EditButton,q as ErrorComponent,G as ErrorMessages,H as FollowButton,O as FooterComponent,R as HeaderComponent,Y as HomeComponent,P as LikeButton,z as LoginComponent,I as ProfileComponent,W as RegisterComponent};
//# sourceMappingURL=index.modern.js.map
