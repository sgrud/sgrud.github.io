{"version":3,"file":"index.modern.js","sources":["../../packages/lazy/src/api/lazy-endpoint.ts","../../packages/lazy/src/components/settings.tsx"],"sourcesContent":["import { HttpClient, Target } from '@sgrud/core';\nimport { map, Observable } from 'rxjs';\nimport { Api, Endpoint, Resource } from 'sgrud-realworld-core';\n\n@Target<typeof LazyEndpoint>()\nexport class LazyEndpoint extends Endpoint {\n\n  public user(user: Partial<Exclude<Api.User, 'token'>>): Observable<Api.User> {\n    return  HttpClient.put<Resource.User>(`${this.url}/user`, { user }).pipe(\n      map(({ response }) => {\n        this.credentials.user = response.user;\n        return response.user;\n      })\n    );\n  }\n\n}\n","import { Factor } from '@sgrud/core';\nimport { Component, Reference, Route, Router } from '@sgrud/shell';\nimport { AjaxResponse as Response } from 'rxjs/ajax';\nimport { Api, Credentials } from 'sgrud-realworld-core';\nimport { AppComponent } from 'sgrud-realworld-eager';\nimport { LazyEndpoint } from '../api/lazy-endpoint';\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'settings-component': SettingsComponent;\n  }\n}\n\n@Route({\n  parent: AppComponent,\n  path: 'settings'\n})\n@Component('settings-component')\nexport class SettingsComponent extends HTMLElement implements Component {\n\n  public readonly styles: string[] = [\n    '@import url(\"//demo.productionready.io/main.css\");'\n  ];\n\n  @Factor(() => Credentials)\n  private readonly credentials!: Credentials;\n\n  @Factor(() => LazyEndpoint)\n  private readonly endpoint!: LazyEndpoint;\n\n  @Reference('form', ['input'])\n  private readonly form?: HTMLFormElement;\n\n  @Factor(() => Router)\n  private readonly router!: Router;\n\n  private readonly errors: string[] = [];\n\n  public get template(): JSX.Element {\n    return <>\n      <div className=\"settings-page\">\n        <div className=\"container page\">\n          <div className=\"row\">\n            <div className=\"col-md-6 col-xs-12 offset-md-3\">\n              <h1 className=\"text-xs-center\">Your Settings</h1>\n              {this.errors.length > 0 && <>\n                <ul className=\"error-messages\">\n                  {this.errors.map((error) => <>\n                    <li>{error}</li>\n                  </>)}\n                </ul>\n              </>}\n              <form key=\"form\">\n                <fieldset>\n                  <fieldset className=\"form-group\">\n                    <input\n                      className=\"form-control\"\n                      name=\"image\"\n                      placeholder=\"URL of profile picture\"\n                      type=\"url\"\n                      value={this.user.image}/>\n                  </fieldset>\n                  <fieldset className=\"form-group\">\n                    <input\n                      className=\"form-control form-control-lg\"\n                      name=\"username\"\n                      placeholder=\"Your Name\"\n                      required={true}\n                      type=\"text\"\n                      value={this.user.username}/>\n                  </fieldset>\n                  <fieldset className=\"form-group\">\n                    <textarea\n                      className=\"form-control form-control-lg\"\n                      name=\"bio\"\n                      placeholder=\"Short bio about you\"\n                      rows={8}>\n                      {this.user.bio}\n                    </textarea>\n                  </fieldset>\n                  <fieldset className=\"form-group\">\n                    <input\n                      className=\"form-control form-control-lg\"\n                      name=\"email\"\n                      pattern=\"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$\"\n                      placeholder=\"Email\"\n                      required={true}\n                      type=\"email\"\n                      value={this.user.email}/>\n                  </fieldset>\n                  <fieldset className=\"form-group\">\n                    <input\n                      className=\"form-control form-control-lg\"\n                      name=\"password\"\n                      pattern=\"^.{8,}$\"\n                      placeholder=\"Password\"\n                      type=\"password\"/>\n                  </fieldset>\n                  <button\n                    className=\"btn btn-lg btn-primary pull-xs-right\"\n                    disabled={!this.form?.checkValidity() || undefined}\n                    onclick={() => this.update()}\n                    type=\"button\">\n                    Update Settings\n                  </button>\n                </fieldset>\n              </form>\n            </div>\n          </div>\n        </div>\n      </div>\n    </>;\n  }\n\n  private get user(): Api.User {\n    return this.credentials.user!;\n  }\n\n  private update(): void {\n    const formData = new FormData(this.form);\n\n    if (this.errors.length) {\n      this.errors.length = 0;\n      (this as Component).renderComponent!();\n    }\n\n    this.endpoint.user({\n      bio: formData.get('bio')!.toString(),\n      email: formData.get('email')!.toString(),\n      image: formData.get('image')!.toString(),\n      password: formData.get('password')!.toString(),\n      username: formData.get('username')!.toString()\n    }).subscribe({\n      error: ({ response }: Response<Api.Error>) => {\n        for (const key in response.errors) {\n          for (const message of response.errors[key]) {\n            this.errors.push(`${key} ${message}`);\n          }\n        }\n\n        (this as Component).renderComponent!();\n      },\n      next: ({ username }) => {\n        this.router.navigate('/profile/' + username).subscribe();\n      }\n    });\n  }\n\n}\n"],"names":["LazyEndpoint","user","HttpClient","put","this","url","pipe","map","response","credentials","__decorate","Target","SettingsComponent","styles","endpoint","form","router","errors","template","_this$form","_Fragment","children","_jsx","className","_jsxs","length","error","name","placeholder","type","value","image","required","username","rows","bio","pattern","email","disabled","checkValidity","undefined","onclick","update","renderComponent","formData","get","toString","password","subscribe","key","push","message","next","navigate","Factor","Credentials","prototype","Reference","Router","Route","parent","AppComponent","path","Component"],"mappings":"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"}