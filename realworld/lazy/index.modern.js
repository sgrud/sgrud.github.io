import e from"@babel/runtime/helpers/extends";import{__decorate as r}from"tslib";import{jsx as t,Fragment as o,jsxs as i}from"@sgrud/shell/jsx-runtime";import{Factor as s}from"@sgrud/core";import{Router as l,Reference as a,Resolve as n,Route as d,Component as c,Fluctuate as m}from"@sgrud/shell";import{of as u}from"rxjs";import{Endpoint as p,UserStore as h}from"sgrud-realworld-core";import{AppComponent as g,ErrorMessages as f}from"sgrud-realworld-eager";let v=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.form=void 0,this.article=void 0,this.errors=void 0}get template(){var e,r,s,l,a,n,d,c;return t(o,{children:t("div",{className:"editor-page",children:t("div",{className:"container page",children:t("div",{className:"row",children:i("div",{className:"col-md-10 col-xs-12 offset-md-1",children:[t(f,{errors:this.errors}),t("form",{children:i("fieldset",{children:[t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"title",placeholder:"Article Title",required:!0,type:"text",value:null!=(e=null==(r=this.article)?void 0:r.title)?e:""})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control",name:"description",placeholder:"What's this article about?",required:!0,type:"text",value:null!=(s=null==(l=this.article)?void 0:l.description)?s:""})}),t("fieldset",{className:"form-group",children:t("textarea",{className:"form-control",name:"body",placeholder:"Write your article (in markdown)",required:!0,rows:8,children:null==(a=this.article)?void 0:a.body})}),i("fieldset",{className:"form-group",children:[t("input",{className:"form-control",name:"tagList",placeholder:"Enter tags",type:"text",value:null!=(n=null==(d=this.article)?void 0:d.tagList.join(" "))?n:""}),t("div",{className:"tag-list"})]}),t("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(c=this.form)&&c.checkValidity())||void 0,onclick:()=>this.updateArticle(),type:"button",children:"Publish Article"})]})},"form")]})})})})})}updateArticle(){const r=new FormData(this.form);this.errors&&(this.errors=void 0,this.renderComponent()),p.updateArticle(e({},this.article,{body:r.get("body").toString(),description:r.get("description").toString(),tagList:r.get("tagList").toString().split(" "),title:r.get("title").toString()})).subscribe({error:({errors:e})=>{this.errors=e,this.renderComponent()},next:e=>this.router.navigate(`/article/${e.slug}`).subscribe()})}};r([s(()=>l)],v.prototype,"router",void 0),r([a("form",["input"])],v.prototype,"form",void 0),r([n(({params:e})=>e.slug?p.readArticle(e.slug):u(void 0))],v.prototype,"article",void 0),v=r([d({parent:g,path:"editor/:slug?"}),c("editor-component")],v);let b=class extends HTMLElement{constructor(...e){super(...e),this.styles=['@import url("/realworld/style.css");'],this.router=void 0,this.userStore=void 0,this.userState=void 0,this.form=void 0,this.errors=void 0}get template(){var e,r,s,l,a,n,d,c;return t(o,{children:t("div",{className:"settings-page",children:t("div",{className:"container page",children:t("div",{className:"row",children:i("div",{className:"col-md-6 col-xs-12 offset-md-3",children:[t("h1",{className:"text-xs-center",children:"Your Settings"}),t(f,{errors:this.errors}),t("form",{children:i("fieldset",{children:[t("fieldset",{className:"form-group",children:t("input",{className:"form-control",name:"image",placeholder:"URL of profile picture",type:"url",value:null!=(e=null==(r=this.userState)?void 0:r.image)?e:""})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"username",placeholder:"Your Name",required:!0,type:"text",value:null!=(s=null==(l=this.userState)?void 0:l.username)?s:""})}),t("fieldset",{className:"form-group",children:t("textarea",{className:"form-control form-control-lg",name:"bio",placeholder:"Short bio about you",rows:8,children:null==(a=this.userState)?void 0:a.bio})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"email",pattern:"^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$",placeholder:"Email",required:!0,type:"email",value:null!=(n=null==(d=this.userState)?void 0:d.email)?n:""})}),t("fieldset",{className:"form-group",children:t("input",{className:"form-control form-control-lg",name:"password",pattern:"^.{8,}$",placeholder:"Password",type:"password"})}),t("button",{className:"btn btn-lg btn-primary pull-xs-right",disabled:!(null!=(c=this.form)&&c.checkValidity())||void 0,onclick:()=>this.dispatchUpdate(),type:"button",children:"Update Settings"})]})},"form"),t("hr",{}),t("button",{className:"btn btn-outline-danger",onclick:()=>this.dispatchLogout(),type:"button",children:"Or click here to logout."})]})})})})})}dispatchLogout(){this.userStore.dispatch("logout").subscribe({error:({errors:e})=>{this.errors=e,this.renderComponent()},next:()=>this.router.navigate("/login").subscribe()})}dispatchUpdate(){const e=new FormData(this.form);this.errors&&(this.errors=void 0,this.renderComponent()),this.userStore.dispatch("update",[{bio:e.get("bio").toString(),email:e.get("email").toString(),image:e.get("image").toString(),password:e.get("password").toString(),username:e.get("username").toString()}]).subscribe({error:({errors:e})=>{this.errors=e,this.renderComponent()},next:({username:e})=>this.router.navigate(`/profile/${e}`).subscribe()})}};r([s(()=>l)],b.prototype,"router",void 0),r([s(()=>h)],b.prototype,"userStore",void 0),r([m(()=>new h)],b.prototype,"userState",void 0),r([a("form",["input"])],b.prototype,"form",void 0),b=r([d({parent:g,path:"settings"}),c("settings-component")],b);export{v as EditorComponent,b as SettingsComponent};
//# sourceMappingURL=index.modern.js.map
